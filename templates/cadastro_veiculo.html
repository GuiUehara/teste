{% extends "base.html" %}

{% block titulo %}Cadastro de Veículo{% endblock %}

{% block conteudo %}
<h2>Cadastro de Veículo</h2>

<form method="POST" action="{{ url_for('cadastro_veiculo') }}" id="formVeiculo">

  <!-- Campos do veículo -->
  <label for="placaVeiculo">Placa</label>
  <input type="text" name="placaVeiculo" id="placaVeiculo" required />

  <label for="chassiVeiculo">Chassi</label>
  <input type="text" name="chassiVeiculo" id="chassiVeiculo" required />

  <label for="anoVeiculo">Ano</label>
  <input type="number" name="anoVeiculo" id="anoVeiculo" required />

  <label for="corVeiculo">Cor</label>
  <input type="text" name="corVeiculo" id="corVeiculo" required />

  <label for="transmissaoVeiculo">Transmissão</label>
  <select name="transmissaoVeiculo" id="transmissaoVeiculo" required>
    <option value="">Selecione</option>
    <option value="manual">Manual</option>
    <option value="automatico">Automático</option>
  </select>

  <label for="dataCompra">Data da Compra</label>
  <input type="date" name="dataCompra" id="dataCompra" required />

  <label for="valorCompra">Valor da Compra</label>
  <input type="number" step="0.01" name="valorCompra" id="valorCompra" required />

  <label for="odometro">Odômetro</label>
  <input type="number" name="odometro" id="odometro" required />

  <label for="vencimentoLicenciamento">Vencimento Licenciamento</label>
  <input type="date" name="vencimentoLicenciamento" id="vencimentoLicenciamento" required />

  <label for="tanque">Tanque (litros)</label>
  <input type="number" name="tanque" id="tanque" required />

  <label for="tanqueFracao">Tanque Fração</label>
  <select name="tanqueFracao" id="tanqueFracao" required>
    <option value="1">Cheio (1/1)</option>
    <option value="0.875">7/8</option>
    <option value="0.75">6/8</option>
    <option value="0.5">1/2</option>
    <option value="0.25">1/4</option>
    <option value="0.125">1/8</option>
    <option value="0.05">Reserva</option>
  </select>

  <label for="combustivel">Combustível</label>
  <select name="combustivel" id="combustivel" required>
    <option value="">Selecione</option>
    {% for comb in combustiveis %}
      <option value="{{ comb[0] }}">{{ comb[1] }}</option>
    {% endfor %}
  </select>

  <label for="marca">Marca</label>
  <select name="marca" id="marca" required>
    <option value="">Selecione</option>
    {% for m in marcas %}
      <option value="{{ m[0] }}">{{ m[1] }}</option>
    {% endfor %}
  </select>

  <label for="modeloVeiculo">Modelo</label>
  <select name="modeloVeiculo" id="modeloVeiculo" required>
    <option value="">Selecione uma marca</option>
  </select>

<label for="categoria">Categoria</label>
<input type="text" name="categoria" id="categoria" readonly placeholder="Seleciona um modelo para ver a categoria" />


  <label for="status">Status</label>
  <select name="status" id="status" required>
    <option value="">Selecione</option>
    {% for s in status %}
      <option value="{{ s[0] }}">{{ s[1] }}</option>
    {% endfor %}
  </select>

  <label for="companhiaSeguro">Companhia Seguro</label>
  <select name="companhiaSeguro" id="companhiaSeguro">
    <option value="">Selecione</option>
    {% for c in seguros %}
      <option value="{{ c[0] }}">{{ c[1] }}</option>
    {% endfor %}
  </select>

  <label for="vencimentoSeguro">Vencimento Seguro</label>
  <input type="date" name="vencimentoSeguro" id="vencimentoSeguro"/>


  <button type="submit">Registrar Veículo</button>
</form>

{% endblock %}

{% block scripts %}
<script>
document.addEventListener("DOMContentLoaded", () => {
    const selectMarca = document.getElementById("marca");
    const selectModelo = document.getElementById("modeloVeiculo");
    const inputCategoria = document.getElementById("categoria");

    // Ao mudar a marca, carrega os modelos correspondentes
    selectMarca.addEventListener("change", e => {
        const marcaId = e.target.value;
        selectModelo.innerHTML = '<option value="">Selecione um modelo</option>';
        inputCategoria.value = ""; // Limpa categoria

        if (!marcaId) return;

        fetch(`/api/modelos/${marcaId}`)
            .then(res => res.json())
            .then(data => {
                data.forEach(m => {
                    const option = document.createElement("option");
                    option.value = m.id;
                    option.textContent = m.nome;
                    option.setAttribute("data-categoria", m.id_categoria_nome); // vamos enviar o nome da categoria na API
                    selectModelo.appendChild(option);
                });
            });
    });

    // Ao mudar o modelo, preenche automaticamente a categoria
    selectModelo.addEventListener("change", e => {
        const selected = e.target.selectedOptions[0];
        const categoriaNome = selected?.getAttribute("data-categoria");
        inputCategoria.value = categoriaNome || "";
    });
});
</script>

{% endblock %}
